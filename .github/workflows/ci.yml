name: Pipeline CI/CD Basico - Modulo 10

# Disparador: Se ejecuta con cada push a la rama 'main'
on:
  push:
    branches:
      - main 

# DefiniciÃ³n de las Etapas (Jobs)
jobs:

  # 1. Job: TESTEO (Instalar + Ejecutar Pruebas)
  # Este es el job inicial y no depende de ningÃºn otro.
  test:
    name: Instalar y Probar CÃ³digo
    runs-on: ubuntu-latest # Runner estÃ¡ndar de CI/CD

    steps:
      - name: ğŸ“¦ Checkout del CÃ³digo
        uses: actions/checkout@v4
      
      - name: âš™ï¸ Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm' # Usa cachÃ© para acelerar la instalaciÃ³n de dependencias

      - name: â¬‡ï¸ InstalaciÃ³n de dependencias (Requisito 1)
        run: npm install

      - name: ğŸ§ª EjecuciÃ³n de pruebas automatizadas (Requisito 2)
        run: npm test

  # 2. Job: CONSTRUCCIÃ“N (BUILD)
  # Se ejecuta SOLO si el job 'test' finaliza con Ã©xito.
  build:
    name: ConstrucciÃ³n de Artefacto
    needs: test # Usar 'needs' para garantizar la secuencia (Requisito 5)
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ Checkout del CÃ³digo
        uses: actions/checkout@v4

      - name: âš™ï¸ Configurar Node.js 18
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: ğŸ› ï¸ Construir Artefacto (Requisito 3)
        # Asume que tu package.json tiene un script 'build' que genera un ejecutable o dist/
        run: npm run build

      - name: â¬†ï¸ Subir Artefacto para Despliegue
        uses: actions/upload-artifact@v4
        with:
          name: app-build-artifact
          path: dist/ # Guarda el resultado de la construcciÃ³n (ejemplo: carpeta 'dist')

  # 3. Job: DESPLIEGUE (DEPLOY)
  # Se ejecuta SOLO si el job 'build' finaliza con Ã©xito.
  deploy:
    name: SimulaciÃ³n de Despliegue
    needs: build # Usar 'needs' para garantizar la secuencia (Requisito 5)
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Descargar Artefacto
        uses: actions/download-artifact@v4
        with:
          name: app-build-artifact

      - name: ğŸš€ SimulaciÃ³n de Despliegue (Requisito 4)
        run: echo "âœ… Deploy realizado con Ã©xito en el servidor de Staging/ProducciÃ³n."